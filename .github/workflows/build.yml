name: Build Windows EXE

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest

    steps:
      # 1Ô∏è‚É£ Puxar o c√≥digo do reposit√≥rio
      - uses: actions/checkout@v4

      # 2Ô∏è‚É£ Configurar Python
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      # 3Ô∏è‚É£ Instalar depend√™ncias e Playwright
      - name: Instalar depend√™ncias
        run: |
          echo "üîπ Atualizando pip e instalando requirements..."
          python -m pip install --upgrade pip
          pip install -r requirements.txt
          echo "üîπ Instalando browsers do Playwright..."
          playwright install --with-deps

      # 4Ô∏è‚É£ Copiar Chromium do cache do Playwright para a pasta do projeto
      - name: Preparar Chromium para PyInstaller
        run: |
          echo "üîπ Criando pasta do Chromium..."
          mkdir -p automacoes\playwright_browsers\chrome-win32
          echo "üîπ Copiando chrome.exe do cache do Playwright..."
          copy "%LOCALAPPDATA%\ms-playwright\chromium-1208\chrome-win32\chrome.exe" automacoes\playwright_browsers\chrome-win32\
          echo "‚úÖ Chromium preparado com sucesso."

      # 5Ô∏è‚É£ Gerar EXE com PyInstaller
      - name: Gerar EXE
        run: |
          echo "üîπ Gerando EXE com PyInstaller..."
          pyinstaller --onefile --log-level=DEBUG automacoes/main.py
          echo "‚úÖ Build do EXE conclu√≠do."

      # 6Ô∏è‚É£ Upload do EXE gerado como artefato
      - name: Upload artefato
        uses: actions/upload-artifact@v4
        with:
          name: automacao-windows
          path: dist/*.exe
          retention-days: 7